<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pick-A-Bookï½œæŠ½æ›¸æ±ºç­–å¡</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;
  background:#0f1115;
  color:#eaeaf0;
}
.topbar{
  position:fixed;top:0;left:0;right:0;height:56px;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 16px;background:#0f1115;border-bottom:1px solid #222;
  z-index:9999;
}
.brand{font-weight:800}
.langToggle{
  display:flex;gap:6px;padding:4px;border-radius:999px;
  border:1px solid #333;background:#1a1c22;
}
.langToggle a{
  text-decoration:none;color:#eaeaf0;
  padding:6px 10px;border-radius:999px;
  font-size:13px;font-weight:700;
}
.langToggle a.active{background:#333}
main{padding:88px 16px 40px;max-width:860px;margin:auto}
.card{
  border:1px solid #2a2d35;border-radius:14px;
  padding:18px;margin-bottom:16px;background:#14161c;
}
button{
  background:#2a2d35;border:1px solid #3a3d45;
  color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer;
}
button:hover{background:#343844}
input{margin:8px 0}
</style>
</head>

<body>

<div class="topbar">
  <div class="brand">Pick-A-Book</div>
  <div class="langToggle">
    <a href="index.html" class="active">ä¸­æ–‡</a>
    <a href="index-en.html">EN</a>
  </div>
</div>

<main>
<h1>æŠ½æ›¸æ±ºç­–å¡</h1>
<p style="opacity:.8">æ›¸ä¸æ˜¯ä¸å¤ ï¼Œæ˜¯é¸ä¸å‡ºä¾†ã€‚</p>

<div class="card">
  <h3>1ï½œä¸Šå‚³ Goodreads CSV</h3>
  <input type="file" id="csvInput" accept=".csv">
  <p style="opacity:.6">æ”¯æ´ to-read / Want to Read / WantToRead</p>
</div>

<div class="card">
  <h3>2ï½œæŠ½ä¸€æœ¬æ›¸</h3>
  <button onclick="drawBook()">æŠ½æ›¸</button>
  <p id="result" style="margin-top:12px;font-weight:700"></p>
</div>

</main>

<script>
const STORAGE_KEY = "pickabook_books_v1";

function norm(s){
  return (s||"").toString().toLowerCase().trim();
}

function parseCSV(text){
  const [head,...rows] = text.split(/\r?\n/);
  const headers = head.split(",");
  return rows.map(r=>{
    const cols=r.split(",");
    const o={};
    headers.forEach((h,i)=>o[h]=cols[i]||"");
    return o;
  });
}

document.getElementById("csvInput").addEventListener("change",e=>{
  const f=e.target.files[0];
  if(!f) return;
  const r=new FileReader();
  r.onload=()=>{
    const rows=parseCSV(r.result);
    const books=[];
    rows.forEach(row=>{
      const ex=norm(row["Exclusive Shelf"]);
      const shelves=norm(row["Bookshelves"]);
      const isTBR =
        ex==="to-read" ||
        shelves.includes("to-read") ||
        shelves.includes("want to read") ||
        shelves.includes("want-to-read") ||
        shelves.includes("wanttoread");
      if(!isTBR) return;
      books.push({
        title:row["Title"],
        author:row["Author"]
      });
    });
    localStorage.setItem(STORAGE_KEY,JSON.stringify(books));
    alert(`å·²åŒ¯å…¥ ${books.length} æœ¬æ›¸`);
  };
  r.readAsText(f);
});

function drawBook(){
  const books=JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");
  if(!books.length){
    alert("å°šæœªåŒ¯å…¥æ›¸å–®");
    return;
  }
  const b=books[Math.floor(Math.random()*books.length)];
  document.getElementById("result").innerText =
    `ğŸ“– ${b.title} â€” ${b.author}`;
}
</script>

</body>
</html>
